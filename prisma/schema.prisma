generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id
  email     String
  name      String
  raw_json  Json?
  deleted_at DateTime?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("users_sync")
  @@schema("neon_auth")
}

model Driver {
  id                      Int       @id @default(autoincrement())
  user_id                 String?
  first_name              String?
  last_name               String?
  phone                   String?
  license_number          String?
  license_expiry          DateTime? @db.Date
  experience_years        Int?
  hire_date               DateTime? @db.Date
  status                  String?
  created_at              DateTime  @default(now())
  updated_at              DateTime  @updatedAt
  email                   String?
  password_hash           String?
  photo_url               String?
  emergency_contact_name  String?
  emergency_contact_phone String?
  last_medical_visit      DateTime? @db.Date
  notes                   String?
  role                    String?   @default("driver")

  // Relations
  trips              Trip[]
  vehicle_assignments VehicleAssignment[]
  alerts             Alert[]

  @@map("drivers")
}

model Vehicle {
  id           Int        @id @default(autoincrement())
  make         String?
  model        String?
  year         Int?
  license_plate String?
  vehicle_type String?
  fuel_type    String?
  capacity     Int?
  mileage      Int?
  status       String?
  created_at   DateTime   @default(now())
  updated_at   DateTime   @updatedAt

  // Relations
  trips               Trip[]
  vehicle_assignments VehicleAssignment[]
  maintenance_records MaintenanceRecord[]
  alerts             Alert[]

  @@map("vehicles")
}

model Trip {
  id                        Int       @id @default(autoincrement())
  driver_id                 Int?
  vehicle_id                Int?
  route_id                  Int?
  start_time                DateTime?
  end_time                  DateTime?
  status                    String?
  passenger_count           Int?
  actual_distance_km        Decimal?
  actual_duration_minutes   Int?
  fuel_consumed_liters      Decimal?
  notes                     String?
  created_at                DateTime  @default(now())
  updated_at                DateTime  @updatedAt

  // Relations
  driver  Driver?  @relation(fields: [driver_id], references: [id])
  vehicle Vehicle? @relation(fields: [vehicle_id], references: [id])
  route   Route?   @relation(fields: [route_id], references: [id])
  alerts  Alert[]

  @@map("trips")
}

model Route {
  id                         Int     @id @default(autoincrement())
  name                       String?
  start_location             String?
  end_location               String?
  start_latitude             Decimal?
  start_longitude            Decimal?
  end_latitude               Decimal?
  end_longitude              Decimal?
  distance_km                Decimal?
  estimated_duration_minutes Int?
  difficulty_level           String?
  route_type                 String?
  created_at                 DateTime @default(now())
  updated_at                 DateTime @updatedAt

  // Relations
  trips  Trip[]
  alerts Alert[]

  @@map("routes")
}

model VehicleAssignment {
  id              Int       @id @default(autoincrement())
  driver_id       Int?
  vehicle_id      Int?
  assigned_date   DateTime? @db.Date
  unassigned_date DateTime? @db.Date
  is_primary      Boolean?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt

  // Relations
  driver  Driver?  @relation(fields: [driver_id], references: [id])
  vehicle Vehicle? @relation(fields: [vehicle_id], references: [id])

  @@map("vehicle_assignments")
}

model MaintenanceRecord {
  id                   Int       @id @default(autoincrement())
  vehicle_id           Int?
  maintenance_type     String?
  description          String?
  service_date         DateTime? @db.Date
  cost                 Decimal?
  service_provider     String?
  technician_name      String?
  mileage_at_service   Int?
  next_service_due     DateTime? @db.Date
  status               String?
  created_at           DateTime  @default(now())
  updated_at           DateTime  @updatedAt

  // Relations
  vehicle Vehicle? @relation(fields: [vehicle_id], references: [id])

  @@map("maintenance_records")
}

model Alert {
  id          Int       @id @default(autoincrement())
  title       String?
  description String?
  type        String?
  severity    String?
  status      String?
  driver_id   Int?
  vehicle_id  Int?
  trip_id     Int?
  route_id    Int?
  resolved_by String?
  resolved_at DateTime?
  created_at  DateTime  @default(now())

  // Relations
  driver  Driver?  @relation(fields: [driver_id], references: [id])
  vehicle Vehicle? @relation(fields: [vehicle_id], references: [id])
  trip    Trip?    @relation(fields: [trip_id], references: [id])
  route   Route?   @relation(fields: [route_id], references: [id])

  @@map("alerts")
}
